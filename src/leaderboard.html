<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Leaderboard</title>
    <link
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
      rel="stylesheet"
      crossorigin="anonymous"
    />
    <style>
      .table-hover tbody tr:hover {
        background-color: #f1f1f1;
      }
      .card {
        transition: transform 0.3s ease, box-shadow 0.3s ease;
      }
      .card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      }
      th {
        cursor: pointer;
      }
    </style>
  </head>

  <body>
    <div class="container">
      <h1 class="text-center my-4">Leaderboard</h1>

      <div class="text-center mb-4">
        <a href="index.html" class="btn btn-primary">Back to Home</a>
      </div>

      <!-- Dropdown to select game mode -->
      <div class="form-group text-center">
        <label for="gameSelect">Select Game Mode:</label>
        <select
          class="form-control"
          id="gameSelect"
          onchange="fetchLeaderboard()"
        >
          <option value="bed">Bed Wars</option>
          <option value="sky">Sky Wars</option>
          <option value="ground">Ground Wars</option>
          <option value="murder">Murder Mystery</option>
          <option value="wars">Treasure Wars</option>
          <option value="party">Party Games</option>
          <option value="dr">Death Run</option>
        </select>
      </div>

      <!-- Table to display leaderboard -->
      <table class="table table-striped table-bordered table-hover">
        <thead id="table-head">
          <tr>
            <th>#</th>
            <th>Username</th>
            <th>XP</th>
            <th>Games Played</th>
            <th>Victories</th>
            <!-- Columns for "Kills" and "Deaths" will be dynamically adjusted -->
            <th id="deaths-column">Deaths</th>
            <th id="kills-column">Kills</th>
          </tr>
        </thead>
        <tbody id="leaderboard"></tbody>
      </table>
    </div>

    <script>
      // Function to fetch leaderboard data based on selected game mode
      function fetchLeaderboard() {
        const selectedGame = document.getElementById('gameSelect').value;
        const apiUrl = `https://api.playhive.com/v0/game/all/${selectedGame}`;

        // Adjust columns based on the game mode
        adjustTableColumns(selectedGame);

        // Fetch leaderboard data from the selected game mode
        fetch(apiUrl)
          .then(response => response.json())
          .then(data => {
            if (data && Array.isArray(data)) {
              displayLeaderboard(data, selectedGame);
            } else {
              document.getElementById('leaderboard').innerHTML =
                '<tr><td colspan="7" class="text-center text-danger">No leaderboard data available.</td></tr>';
            }
          })
          .catch(error => {
            console.error('Error fetching leaderboard data:', error);
            document.getElementById('leaderboard').innerHTML =
              '<tr><td colspan="7" class="text-center text-danger">Error fetching leaderboard data.</td></tr>';
          });
      }

      // Function to adjust the table columns based on the game mode
      function adjustTableColumns(gameMode) {
        const deathsColumn = document.getElementById('deaths-column');
        const killsColumn = document.getElementById('kills-column');

        if (gameMode === 'party') {
          // Remove both Deaths and Kills columns for "Party Games"
          deathsColumn.style.display = 'none';
          killsColumn.style.display = 'none';
        } else {
          // Restore the columns for other game modes
          deathsColumn.style.display = '';
          killsColumn.style.display = '';
        }
      }

      // Function to display the leaderboard data
      function displayLeaderboard(players, gameMode) {
        const leaderboardTable = document.getElementById('leaderboard');
        leaderboardTable.innerHTML = ''; // Clear previous data
        players.forEach(player => {
          const playerRow = document.createElement('tr');
          let killsColumn = '';
          let deathsColumn = '';

          if (gameMode === 'murder') {
            killsColumn = player.murders; // For "Murder Mystery", show "murders"
            deathsColumn = player.deaths; // Show deaths for "Murder Mystery"
          } else if (gameMode === 'party') {
            killsColumn = ''; // No kills for "Party Games"
            deathsColumn = ''; // No deaths for "Party Games"
          } else {
            killsColumn = player.kills; // For other game modes, show "kills"
            deathsColumn = player.deaths; // Show "deaths"
          }

          playerRow.innerHTML = `
            <td>${player.human_index}</td>
            <td>${player.username}</td>
            <td>${player.xp}</td>
            <td>${player.played}</td>
            <td>${player.victories}</td>
            <td>${deathsColumn}</td>
            <td>${killsColumn}</td>
          `;
          leaderboardTable.appendChild(playerRow);
        });
      }

      // Initialize leaderboard when page loads with default game mode
      window.onload = fetchLeaderboard;
    </script>

    <script
      src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
